*&---------------------------------------------------------------------*
*& Report ZHUG_ARMAZENA_LINHA
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zhug_armazena_linha.
*** Ini - HUGOANSILVA - TEXTO - 05.06.2024 09:30:41 ***

* Declaração de variáveis globais
DATA: gt_dados        TYPE TABLE OF mara,
      gs_dados        TYPE mara,
      gt_selecionados TYPE TABLE OF mara.

* Definição da estrutura de dados para a tabela MARA
TYPES: BEGIN OF ty_mara,
         matnr TYPE matnr,
         mtart TYPE mtart,
       END OF ty_mara.

* Declaração da tabela interna para a ALV
DATA: gt_alv TYPE TABLE OF ty_mara.

* Declaração de variáveis de controle
DATA: gv_grid   TYPE REF TO cl_gui_alv_grid,
      gv_okcode TYPE sy-ucomm.

* Selecionar dados da MARA e carregar na ALV
START-OF-SELECTION.
  SELECT * FROM mara INTO TABLE gt_dados UP TO 10 ROWS.
  LOOP AT gt_dados INTO gs_dados.
    MOVE-CORRESPONDING gs_dados TO gt_alv.
  ENDLOOP.

* Exibir ALV e permitir seleção de linhas
  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program = sy-repid
      it_fieldcat        = gt_fieldcat
    TABLES
      t_outtab           = gt_alv
    EXCEPTIONS
      program_error      = 1
      OTHERS             = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  CALL METHOD cl_gui_cfw=>flush.

  SET PF-STATUS 'STANDARD'.

  LOOP AT gt_alv INTO gs_dados.
    MODIFY gt_alv FROM gs_dados TRANSPORTING mtart WHERE matnr = gs_dados-matnr.
  ENDLOOP.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program = sy-repid
      it_fieldcat        = gt_fieldcat
    TABLES
      t_outtab           = gt_alv
    EXCEPTIONS
      program_error      = 1
      OTHERS             = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

FORM user_command USING r_ucomm LIKE sy-ucomm
                        rs_selfield TYPE slis_selfield.
  CASE r_ucomm.
    WHEN 'SELE'.
      LOOP AT gt_alv INTO gs_dados WHERE selected = 'X'.
        APPEND gs_dados TO gt_selecionados.
      ENDLOOP.
      CLEAR: gt_alv.
      EXIT.
    WHEN OTHERS.
      CLEAR: gt_selecionados.
  ENDCASE.
ENDFORM.


*** Fim - HUGOANSILVA ***